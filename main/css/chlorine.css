/* chlorine.css */

/* ... Các phần định vị khung giữ nguyên ... */
.chlorine-part {
    position: absolute;
    width: 200px;
    height: 350px;
    overflow: visible !important;
    pointer-events: none;
    user-select: none;
    transform: translate(-50%, -50%);
    will-change: left, top;
}

.chlorine-part.is-body { z-index: 40; }
.chlorine-part.is-cap { z-index: 41; }

.chlorine-part svg {
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: visible !important;
}

.chlorine-cls-1 { display: none; }

#chlorine-body, #chlorine-cap {
    pointer-events: all;
    cursor: grab;
}

#chlorine-body:active, #chlorine-cap:active {
    cursor: grabbing;
}

/* --- LOGIC PHẢN ỨNG --- */

.reaction-group {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease-in;
}

.reaction-group.active {
    opacity: 1;
}

/* ANIMATION LỬA */
@keyframes reaction-flicker {
    0% { transform: scale(1); opacity: 0.9; }
    50% { transform: scale(0.95); opacity: 0.85; } /* Mềm hơn, giảm rung */
    100% { transform: scale(1.05); opacity: 1; }
}

.reaction-core {
    transform-origin: 205px 270px;
    animation: reaction-flicker 0.15s infinite alternate; /* Chậm hơn tí để mượt */
    opacity: 1;
    transition: opacity 0.5s ease-out, transform 0.5s ease-in; /* Giảm thời gian transition CSS xuống, vì JS sẽ handle chính */
}

/* --- TRẠNG THÁI KẾT THÚC (FINISHED) --- */

/* 1. Xử lý Lửa tắt - Giờ JS sẽ handle opacity/scale, CSS chỉ dừng animation */
.reaction-group.finished .reaction-core {
    animation: none; /* Dừng flicker ngay lập tức để tránh khựng */
}

/* 2. Xử lý Khói (Cross-fade) - Thêm delay để đồng bộ với tắt lửa */
.smoke-burning {
    opacity: 1;
    transition: opacity 3s ease-out 0.5s; /* Delay 0.5s để lửa bắt đầu tắt trước */
}

.smoke-product {
    opacity: 0;
    transition: opacity 4s ease-in 1s; /* Delay 1s để overlap với tắt lửa */
}

.reaction-group.finished .smoke-burning { opacity: 0; }
.reaction-group.finished .smoke-product { opacity: 1; }

/* 3. Khí gốc - Giữ nguyên */
.gas-faded {
    opacity: 0 !important;
    transition: opacity 1.5s ease; /* Tăng tí để đồng bộ */
}